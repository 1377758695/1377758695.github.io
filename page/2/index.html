<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"weihongpan.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":"mac","style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="跬步千里">
<meta property="og:type" content="website">
<meta property="og:title" content="潘薇鸿">
<meta property="og:url" content="https://weihongpan.github.io/page/2/index.html">
<meta property="og:site_name" content="潘薇鸿">
<meta property="og:description" content="跬步千里">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="潘薇鸿">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://weihongpan.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>潘薇鸿</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">潘薇鸿</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">keep on fighting</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/WeihongPan" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/experiment/%E5%A6%82%E4%BD%95%E5%B0%86Labelme%E6%A0%87%E6%B3%A8%E5%9B%BE%E5%83%8F%E8%BD%AC%E4%B8%BACULane%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/experiment/%E5%A6%82%E4%BD%95%E5%B0%86Labelme%E6%A0%87%E6%B3%A8%E5%9B%BE%E5%83%8F%E8%BD%AC%E4%B8%BACULane%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F/" class="post-title-link" itemprop="url">如何将Labelme标注图像转为CULane数据集格式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-22 20:31:34" itemprop="dateCreated datePublished" datetime="2021-04-22T20:31:34+08:00">2021-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-23 14:49:55" itemprop="dateModified" datetime="2021-04-23T14:49:55+08:00">2021-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/experiment/" itemprop="url" rel="index"><span itemprop="name">experiment</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>毕设做铁路轨道检测，发现Lane Detection的大部分开源代码都是跑的公用数据集CULane（或Tusimple），而我们自己采集的数据用labelme标注完以后不是CULane的标准格式。为了能直接用公开代码训练我们自己的数据集，需要先把labelme标注的json数据转化成CULane标准格式。</p>
<p>项目地址：[labelme_to_culane] </p>
<h3 id="CULane数据集"><a href="#CULane数据集" class="headerlink" title="CULane数据集"></a>CULane数据集</h3><p>根据<a target="_blank" rel="noopener" href="https://xingangpan.github.io/projects/CULane.html">官网</a>的介绍，CULane数据集文件包括：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- driver_23_30frame</span><br><span class="line">- driver_161_90frame</span><br><span class="line">- driver_182_30frame</span><br><span class="line">- driver_37_30frame</span><br><span class="line">- driver_100_30frame</span><br><span class="line">- driver_193_90frame</span><br><span class="line">- laneseg_label_w16</span><br><span class="line">- list</span><br></pre></td></tr></table></figure>
<ul>
<li><p>三个训练集&amp;验证集ground truth图像与标注：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- driver_23_30frame</span><br><span class="line">- driver_161_90frame</span><br><span class="line">- driver_182_30frame</span><br></pre></td></tr></table></figure>
<p>每个文件夹下都包含若干视频中抽帧形成的子文件夹，每个子文件夹又包含若干图像数据文件（eg. xxxx.jpg）和一个对应的标注文件（xxxx.lines.txt），以182_30文件为例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- driver_182_30frame</span><br><span class="line">  - 05312327_0001.MP4</span><br><span class="line">    |- 00000.jpg</span><br><span class="line">    |- 00000.lines.txt</span><br><span class="line">    |- 00030.jpg</span><br><span class="line">    |- 00030.lines.txt</span><br><span class="line">    |- 00060.jpg</span><br><span class="line">    |- 00060.lines.txt</span><br><span class="line">    ...</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<p>标注文件中每一行都给出了车道线上关键点的对应（x，y）坐标，以 <code>05130.lines.txt</code> 为例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">104.092 590 123.101 580 144.826 570 165.645 560 187.369 550 208.189 540 229.913 530 250.733 520 272.457 510 293.277 500 315.001 490 335.82 480 357.545 470 379.269 460 399.746 450 421.471 440 442.29 430 464.015 420 485.373 410 506.192 400 527.551 390 549.275 380 570.095 370 591.452 360 613.176 350 633.996 340 655.72 330 677.001 320 698.726 310 719.545 300 740.828 290 762.552 280 783.371 270 </span><br><span class="line">661.843 590 665.482 580 669.121 570 673.124 560 677.128 550 681.131 540 684.77 530 688.773 520 692.775 510 696.778 500 700.417 490 704.419 480 708.422 470 712.06 460 716.093 450 720.096 440 724.099 430 727.918 420 731.922 410 735.562 400 739.746 390 743.385 380 747.387 370 751.206 360 755.208 350 759.211 340 763.215 330 766.854 320 770.858 310 774.862 300 778.5 290 782.503 280 786.505 270 </span><br><span class="line">1457.13 590 1438.25 580 1418.46 570 1397.78 560 1377.09 550 1356.41 540 1335.96 530 1315.27 520 1294.59 510 1273.91 500 1253.22 490 1232.77 480 1212.09 470 1192.3 460 1171.62 450 1150.94 440 1130.47 430 1109.79 420 1089.11 410 1068.42 400 1047.74 390 1027.84 380 1007.16 370 986.473 360 965.79 350 945.106 340 924.422 330 903.617 320 883.833 310 863.149 300 842.466 290 821.782 280 801.099 270 </span><br><span class="line">1676.79 450 1632.17 440 1587.27 430 1542.37 420 1497.07 410 1452.17 400 1406.89 390 1361.98 380 1317.08 370 1272.76 360 1227.86 350 1182.96 340 1137.76 330 1092.86 320 1047.96 310 1003.06 300 957.841 290 912.94 280 868.04 270 </span><br></pre></td></tr></table></figure>
<p>其中，关键点选取的y坐标，是固定的，称其为<strong>行锚点</strong> ，默认图像大小为288 * 800：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">culane_row_anchor = [121, 131, 141, 150, 160, 170, 180, 189, 199, 209, 219, 228, 238, 248, 258, 267, 277, 287]</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试集ground truth图像及标注：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- driver_37_30frame</span><br><span class="line">- driver_100_30frame</span><br><span class="line">- driver_193_90frame</span><br></pre></td></tr></table></figure>
<p>格式与训练集/验证集相同</p>
</li>
<li><p>训练集/验证集车道线分割label图像：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- laneseg_label_w16</span><br></pre></td></tr></table></figure>
<p>该文件夹下为训练集/验证集中所有ground truth图像所对应的逐像素label图，即每个像素点的值表示它所在的车道线id，0表示背景。</p>
</li>
<li><p>训练集/验证集/测试集列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- </span><br><span class="line">  - list</span><br><span class="line">    |- test_split</span><br><span class="line">       |- test0_normal.txt</span><br><span class="line">       |- test1_crowd.txt</span><br><span class="line">       |- test2_hlight.txt</span><br><span class="line">       |- test3_shadow.txt</span><br><span class="line">       |- test4_noline.txt</span><br><span class="line">       |- test5_arrow.txt</span><br><span class="line">       |- test6_curve.txt</span><br><span class="line">       |- test7_cross.txt</span><br><span class="line">       |- test8_night.txt</span><br><span class="line">    |- test.txt</span><br><span class="line">    |- train.txt</span><br><span class="line">    |- train_gt.txt</span><br><span class="line">    |- val.txt</span><br><span class="line">    |- val_gt.txt</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>trian.txt</code> <code>val.txt</code> <code>test.txt</code> 都是对应训练集/验证集/测试集图像的相对路径，以 <code>test.txt</code> 为例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/driver_100_30frame/05251517_0433.MP4/00000.jpg</span><br><span class="line">/driver_100_30frame/05251517_0433.MP4/00030.jpg</span><br><span class="line">/driver_100_30frame/05251517_0433.MP4/00060.jpg</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>test_split</code> 文件夹下的文件是将测试集 <code>test.txt</code> 分为不同的环境后重组，本质也是图像的相对路径</p>
</li>
<li><p><code>train_gt.txt</code> 和 <code>val_gt.txt</code> 中每行的格式为：</p>
<p>gt图像相对路径 逐像素label图像相对路径 四个0/1数字表示\&lt;左2>&lt;左1>&lt;右1>&lt;右2>四个车道是否存在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/driver_23_30frame/05171102_0766.MP4/00020.jpg /laneseg_label_w16/driver_23_30frame/05171102_0766.MP4/00020.png 1 1 1 0</span><br><span class="line">/driver_23_30frame/05171102_0766.MP4/00050.jpg /laneseg_label_w16/driver_23_30frame/05171102_0766.MP4/00050.png 1 1 1 0</span><br><span class="line">/driver_23_30frame/05171102_0766.MP4/00080.jpg /laneseg_label_w16/driver_23_30frame/05171102_0766.MP4/00080.png 1 1 1 0</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="从json标注文件到label-png"><a href="#从json标注文件到label-png" class="headerlink" title="从json标注文件到label.png"></a>从json标注文件到label.png</h3><p>labelme提供了将json文件转为label.png的方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">labelme_json_to_dataset [-h] [-o output_file] json_file.json</span><br></pre></td></tr></table></figure>
<p>此方法实现对一个json文件的转换，将生成以下文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- output_file</span><br><span class="line">  |- json_file_json</span><br><span class="line">     |- img.png</span><br><span class="line">     |- label.png</span><br><span class="line">     |- label_names.txt</span><br><span class="line">     |- lable_viz.png</span><br></pre></td></tr></table></figure>
<p>实现json文件批量转化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path <span class="keyword">as</span> osp</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> os.listdir(json_files_path):</span><br><span class="line">    json_data = osp.join(json_files_path, name)</span><br><span class="line">    os.system(<span class="string">&quot;labelme_json_to_dataset json_data -o &quot;</span> + output_path)</span><br></pre></td></tr></table></figure>
<p>如果在标注的时候不是用的纯数字，labelme在进行转换的时候会首先对标注进行字符串排序，排序后的结果在 <code>label_names.txt</code> 中；<code>label.png</code> 虽然看上去是彩色图，但用 <code>PIL.Image</code> 读入后会发现，这其实是个逐像素分类的图，像素值由 <code>label_names.txt</code> 中的标注顺序生成（下标/像素从0开始，其中0表示的是背景，即 <code>label_names.txt</code> 中的第一个默认分类 <code>_background_</code> ）。存在的像素值对应 <code>*_gt.txt</code> 中的值为1，否则为0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">label = Image.<span class="built_in">open</span>(label_path)</span><br><span class="line">label_data = ny.asarray(label).copy()</span><br><span class="line">label.save(target_path)</span><br></pre></td></tr></table></figure>
<p>这样就得到了我们需要的 <code>xxxx_label.png</code> 文件</p>
<h3 id="从label-png到-xxxx-lines-txt-和-gt-txt-文件"><a href="#从label-png到-xxxx-lines-txt-和-gt-txt-文件" class="headerlink" title="从label.png到 xxxx.lines.txt 和 *_gt.txt 文件"></a>从label.png到 xxxx.lines.txt 和 *_gt.txt 文件</h3><ul>
<li>根据 <code>label.png</code> 和 <code>culane_row_anchor</code> 获取轨道线上关键点的坐标生成 <code>xxxx.lines.txt</code> </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># image = Image.open(image_path)</span></span><br><span class="line">label = Image.<span class="built_in">open</span>(label_path)</span><br><span class="line">w, h = label.size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将行采样点按输入图像高度放缩</span></span><br><span class="line"><span class="keyword">if</span> h != <span class="number">288</span>:</span><br><span class="line">    scale_f = <span class="keyword">lambda</span> x : <span class="built_in">int</span>((x * <span class="number">1.0</span>/<span class="number">288</span>) * h)</span><br><span class="line">    sample_tmp = <span class="built_in">list</span>(<span class="built_in">map</span>(scale_f,culane_row_anchor)) </span><br><span class="line">    <span class="comment"># 根据提供的函数对指定序列做映射</span></span><br><span class="line"></span><br><span class="line">lines = <span class="string">&quot;&quot;</span> </span><br><span class="line"><span class="keyword">for</span> i,r <span class="keyword">in</span> <span class="built_in">enumerate</span>(sample_tmp):</span><br><span class="line">    label_r = np.asarray(label)[<span class="built_in">int</span>(<span class="built_in">round</span>(r))] </span><br><span class="line">    <span class="comment"># 取出label图像中行坐标为int(round(r))的一行        </span></span><br><span class="line">    <span class="keyword">for</span> lane_idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">        line = <span class="string">&quot;&quot;</span></span><br><span class="line">        pos = np.where(label_r == lane_idx)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(pos) == <span class="number">0</span>:            </span><br><span class="line">            <span class="keyword">continue</span>        </span><br><span class="line">        pos = np.mean(pos)        </span><br><span class="line">        line = line + <span class="built_in">str</span>(pos) + <span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(r) + <span class="string">&quot; &quot;</span></span><br><span class="line">        <span class="comment"># print(line)</span></span><br><span class="line">        <span class="comment"># cv2.circle(image, (int(round(pos)), int(round(r))), 1, (0,0,255),2)       </span></span><br><span class="line">    lines = lines + line + <span class="string">&quot;\n&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(lines_file_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(lines)</span><br></pre></td></tr></table></figure>
<ul>
<li>根据 <code>label.png</code> 生成 <code>*_gt.txt</code> </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">lines = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> label_path <span class="keyword">in</span> os.listdir(label_file_path):</span><br><span class="line">    label = Image.<span class="built_in">open</span>(label_path)</span><br><span class="line">    label_data = np.asarray(label).copy()</span><br><span class="line">    np.unique(label_data)</span><br><span class="line">    line = gt_image_path + <span class="string">&#x27; &#x27;</span> + label_path</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">5</span>):</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> label_data:</span><br><span class="line">            line = line + <span class="string">&#x27; 1&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            line = line + <span class="string">&#x27; 0&#x27;</span></span><br><span class="line">    lines = lines + line + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(gt_file_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(lines)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/Eigen/%E5%BD%92%E7%BA%A6%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E5%B9%BF%E6%92%AD%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Eigen/%E5%BD%92%E7%BA%A6%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E5%B9%BF%E6%92%AD%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">归约、迭代器和广播机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-22 11:51:55" itemprop="dateCreated datePublished" datetime="2021-04-22T11:51:55+08:00">2021-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-23 15:38:02" itemprop="dateModified" datetime="2021-04-23T15:38:02+08:00">2021-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Eigen/" itemprop="url" rel="index"><span itemprop="name">Eigen</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本章介绍Eigen中的归约( <code>Reductions</code> )，迭代器( <code>Visitors</code> ) 和广播( <code>Broadcasting</code> )机制，以及它们是如何应用与矩阵和数组的。</p>
<h3 id="归约"><a href="#归约" class="headerlink" title="归约"></a>归约</h3><p>归约指的是一类以矩阵或数组作为输入，返回一个标量值的函数。</p>
<h4 id="常用归约函数"><a href="#常用归约函数" class="headerlink" title="常用归约函数"></a>常用归约函数</h4><p><code>.sum()</code> <code>.prod()</code> <code>.mean()</code> <code>.minCoeff()</code> <code>.maxCoeff()</code> <code>.trace()</code></p>
<h4 id="范数计算"><a href="#范数计算" class="headerlink" title="范数计算"></a>范数计算</h4><ul>
<li><code>.norm()</code> : L-2 范数（所有系数平方和开根号）</li>
<li><code>.squaredNorm()</code> : L-2 范数的平方（所有系数平方和）</li>
<li><code>.lpNorm&lt;p&gt;()</code> : P范数（所有系数绝对值的p次幂之和的p次根），当 <code>p=Infinity</code> 时表示所有系数绝对值的最大值</li>
</ul>
<h4 id="逻辑归约函数"><a href="#逻辑归约函数" class="headerlink" title="逻辑归约函数"></a>逻辑归约函数</h4><ul>
<li><code>.all()</code> : Matrix 或 Array 的所有系数均为 true 时返回 true</li>
<li><code>.any()</code> : Matrix 或 Array 存在某个系数为 true 时返回 true</li>
<li><code>.count()</code> : 返回 Matrix 或 Array 中为 true 的系数总个数</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">ArrayXXf <span class="title">a</span><span class="params">(<span class="number">2</span>,<span class="number">2</span>)</span></span>; </span><br><span class="line">  	a &lt;&lt; <span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">         <span class="number">3</span>,<span class="number">4</span>; </span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;(a &gt; 0).all()   = &quot;</span> &lt;&lt; (a &gt; <span class="number">0</span>).<span class="built_in">all</span>() &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;(a &gt; 0).any()   = &quot;</span> &lt;&lt; (a &gt; <span class="number">0</span>).<span class="built_in">any</span>() &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;(a &gt; 0).count() = &quot;</span> &lt;&lt; (a &gt; <span class="number">0</span>).<span class="built_in">count</span>() &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;(a &gt; 2).all()   = &quot;</span> &lt;&lt; (a &gt; <span class="number">2</span>).<span class="built_in">all</span>() &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;(a &gt; 2).any()   = &quot;</span> &lt;&lt; (a &gt; <span class="number">2</span>).<span class="built_in">any</span>() &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;(a &gt; 2).count() = &quot;</span> &lt;&lt; (a &gt; <span class="number">2</span>).<span class="built_in">count</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(a &gt; 0).all()   = 1</span><br><span class="line">(a &gt; 0).any()   = 1</span><br><span class="line">(a &gt; 0).count() = 4</span><br><span class="line"></span><br><span class="line">(a &gt; 2).all()   = 0</span><br><span class="line">(a &gt; 2).any()   = 1</span><br><span class="line">(a &gt; 2).count() = 2</span><br></pre></td></tr></table></figure>
<h4 id="部分归约"><a href="#部分归约" class="headerlink" title="部分归约"></a>部分归约</h4><p>部分归约是可以对矩阵或数组按列或行进行操作的归约，对每个列或行应用归约运算，然后返回具有相应值的列或行向量。部分归约由函数 <code>.colwise()</code> 和 <code>rowwise()</code> 实现：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">Eigen::MatrixXf <span class="title">mat</span><span class="params">(<span class="number">2</span>,<span class="number">4</span>)</span></span>;</span><br><span class="line">  	mat &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">9</span>,</span><br><span class="line">           <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">2</span>;</span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;Column&#x27;s maximum: &quot;</span> &lt;&lt; endl</span><br><span class="line">   		 &lt;&lt; mat.<span class="built_in">colwise</span>().<span class="built_in">maxCoeff</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Row&#x27;s maximum: &quot;</span> &lt;&lt; endl</span><br><span class="line">   		 &lt;&lt; mat.<span class="built_in">rowwise</span>().<span class="built_in">maxCoeff</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Column<span class="string">&#x27;s maximum: </span></span><br><span class="line"><span class="string">3 2 7 9</span></span><br><span class="line"><span class="string">Row&#x27;</span>s maximum: </span><br><span class="line">9</span><br><span class="line">7</span><br></pre></td></tr></table></figure>
<p>显然：<strong>列操作返回行向量，行操作返回列向量</strong> </p>
<h4 id="将部分归约与其他操作结合"><a href="#将部分归约与其他操作结合" class="headerlink" title="将部分归约与其他操作结合"></a>将部分归约与其他操作结合</h4><p>例：寻找系数和最大的列</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  	<span class="function">MatrixXf <span class="title">mat</span><span class="params">(<span class="number">2</span>,<span class="number">4</span>)</span></span>;</span><br><span class="line">  	mat &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">9</span>,</span><br><span class="line">           <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">2</span>;</span><br><span class="line">  </span><br><span class="line">  	MatrixXf::Index   maxIndex;</span><br><span class="line">  	<span class="keyword">float</span> maxNorm = mat.<span class="built_in">colwise</span>().<span class="built_in">sum</span>().<span class="built_in">maxCoeff</span>(&amp;maxIndex);</span><br><span class="line">  </span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;Maximum sum at position &quot;</span> &lt;&lt; maxIndex &lt;&lt; endl;</span><br><span class="line"> </span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;The corresponding vector is: &quot;</span> &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; mat.<span class="built_in">col</span>( maxIndex ) &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;And its sum is is: &quot;</span> &lt;&lt; maxNorm &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Maximum sum at position 2</span><br><span class="line">The corresponding vector is: </span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">And its sum is is: 13</span><br></pre></td></tr></table></figure>
<h3 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h3><p>最常用的就是利用visitor机制获取矩阵/数组中最大值/最小值的位置，交给一个visitor的参数是指向存储行列位置变量的指针，变量类型为 <code>Index</code> ：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  	<span class="function">Eigen::MatrixXf <span class="title">m</span><span class="params">(<span class="number">2</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">  </span><br><span class="line">  	m &lt;&lt; <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">         <span class="number">3</span>, <span class="number">4</span>;</span><br><span class="line"> </span><br><span class="line">  	<span class="comment">//get location of maximum</span></span><br><span class="line">  	MatrixXf::Index maxRow, maxCol;</span><br><span class="line">  	<span class="keyword">float</span> max = m.<span class="built_in">maxCoeff</span>(&amp;maxRow, &amp;maxCol);</span><br><span class="line"> </span><br><span class="line"> 	<span class="comment">//get location of minimum</span></span><br><span class="line">  	MatrixXf::Index minRow, minCol;</span><br><span class="line">  	<span class="keyword">float</span> min = m.<span class="built_in">minCoeff</span>(&amp;minRow, &amp;minCol);</span><br><span class="line"> </span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;Max: &quot;</span> &lt;&lt; max &lt;&lt;  <span class="string">&quot;, at: &quot;</span> </span><br><span class="line">         &lt;&lt; maxRow &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; maxCol &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;Min: &quot;</span> &lt;&lt; min &lt;&lt; <span class="string">&quot;, at: &quot;</span> </span><br><span class="line">         &lt;&lt; minRow &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; minCol &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Max: 4, at: 1,1</span><br><span class="line">Min: 1, at: 0,0</span><br></pre></td></tr></table></figure>
<h3 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h3><p>广播机制类似于部分规约，区别在于广播构造了一个表达式，其中向量被解释成了一个矩阵，这个矩阵由向量在行/列方向上复制自身形成。</p>
<h4 id="加减（-、-、-、-）"><a href="#加减（-、-、-、-）" class="headerlink" title="加减（+、-、+=、-=）"></a>加减（+、-、+=、-=）</h4><p><strong>只能用于Vector类型的对象！！！</strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  	<span class="function">Eigen::MatrixXf <span class="title">mat</span><span class="params">(<span class="number">2</span>,<span class="number">4</span>)</span></span>;</span><br><span class="line">  	<span class="function">Eigen::VectorXf <span class="title">v</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">  	mat &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">9</span>,</span><br><span class="line">           <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">2</span>;   </span><br><span class="line">  	v &lt;&lt; <span class="number">0</span>,</span><br><span class="line">         <span class="number">1</span>;</span><br><span class="line">       </span><br><span class="line">  	<span class="comment">//add v to each column of m</span></span><br><span class="line">  	mat.<span class="built_in">colwise</span>() += v;</span><br><span class="line">  </span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;Broadcasting result: &quot;</span> &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; mat &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Eigen::VectorXf <span class="title">w</span><span class="params">(<span class="number">4</span>)</span></span>;</span><br><span class="line">    w &lt;&lt; <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br><span class="line">       </span><br><span class="line">  	<span class="comment">//add w to each row of m</span></span><br><span class="line">  	mat.<span class="built_in">rowwise</span>() += v.<span class="built_in">transpose</span>();</span><br><span class="line">	  </span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;Broadcasting result: &quot;</span> &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; mat &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Broadcasting result: </span><br><span class="line">1 2 6 9</span><br><span class="line">4 2 8 3</span><br><span class="line">Broadcasting result: </span><br><span class="line">1 3  8 12</span><br><span class="line">4 3 10  6</span><br></pre></td></tr></table></figure>
<p>在执行 <code>mat.colwise() += v</code> 时，相当于进行了两步操作，首先将向量 <code>v</code> 在行方向上复制了4次形成了一个新的4x2的矩阵，再将这个矩阵和矩阵 <code>mat</code> 进行加法操作：</p>
<script type="math/tex; mode=display">
\begin{bmatrix}
1 & 2 & 6 & 9 \\
3 & 1 & 7 & 2 
\end{bmatrix} + 
\begin{bmatrix}
0 & 0 & 0 & 0 \\
1 & 1 & 1 & 1 
\end{bmatrix} = 
\begin{bmatrix}
1 & 2 & 6 & 9 \\
4 & 2 & 8 & 3 
\end{bmatrix}</script><p>只有向量才能进行按行列加减，不能是矩阵，否则会报编译错误；</p>
<p>Array类同理，只能对 <code>ArrayXf</code> 执行这种操作</p>
<h4 id="乘除（、-、-、-）"><a href="#乘除（、-、-、-）" class="headerlink" title="乘除（、/、\=、/=）"></a>乘除（<em>、/、\</em>=、/=）</h4><p>按行/按列执行系数级乘法除法运算。</p>
<p><strong>只能用于 Array 类型的对象！！！</strong></p>
<p>如果想让矩阵第 <code>i</code> 列乘上向量的第 <code>i</code> 个系数，应该写成 <code>mat = mat * v.asDiagonal()</code> </p>
<h4 id="将广播与其他操作结合"><a href="#将广播与其他操作结合" class="headerlink" title="将广播与其他操作结合"></a>将广播与其他操作结合</h4><p>例：在矩阵 <code>m</code> 中找到与向量 <code>v</code> 距离最近的列向量</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Dense&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  	<span class="function">Eigen::MatrixXf <span class="title">m</span><span class="params">(<span class="number">2</span>,<span class="number">4</span>)</span></span>;</span><br><span class="line">  	<span class="function">Eigen::VectorXf <span class="title">v</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">  </span><br><span class="line"> 	 m &lt;&lt; <span class="number">1</span>, <span class="number">23</span>, <span class="number">6</span>, <span class="number">9</span>,</span><br><span class="line">          <span class="number">3</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">2</span>;</span><br><span class="line">       </span><br><span class="line">  	v &lt;&lt; <span class="number">2</span>,</span><br><span class="line">         <span class="number">3</span>;</span><br><span class="line"> </span><br><span class="line">  	MatrixXf::Index index;</span><br><span class="line">  	<span class="comment">// find nearest neighbour</span></span><br><span class="line">  	(m.<span class="built_in">colwise</span>() - v).<span class="built_in">colwise</span>().<span class="built_in">squaredNorm</span>().<span class="built_in">minCoeff</span>(&amp;index);</span><br><span class="line"> </span><br><span class="line">  	cout &lt;&lt; <span class="string">&quot;Nearest neighbour is column &quot;</span> &lt;&lt; index &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; endl;</span><br><span class="line">  	cout &lt;&lt; m.<span class="built_in">col</span>(index) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Nearest neighbour is column 0:</span><br><span class="line">1</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/Eigen/%E9%AB%98%E7%BA%A7%E5%88%9D%E5%A7%8B%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Eigen/%E9%AB%98%E7%BA%A7%E5%88%9D%E5%A7%8B%E5%8C%96/" class="post-title-link" itemprop="url">高级初始化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-22 11:03:50" itemprop="dateCreated datePublished" datetime="2021-04-22T11:03:50+08:00">2021-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-23 15:37:24" itemprop="dateModified" datetime="2021-04-23T15:37:24+08:00">2021-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Eigen/" itemprop="url" rel="index"><span itemprop="name">Eigen</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本章介绍矩阵初始化的一些高级方法，包括逗号初始化和一些特殊矩阵（单位矩阵、零矩阵）初始化</p>
<h3 id="逗号初始化"><a href="#逗号初始化" class="headerlink" title="逗号初始化"></a>逗号初始化</h3><ul>
<li><p>系数初始化顺序：从左上角开始，按从左到右，从上到下的顺序排列</p>
</li>
<li><p>必须预先规定好矩阵/向量/数组的大小，否则会报错</p>
</li>
<li><p>初始化列表的元素除了数值外，也可以是向量或矩阵，常用来连接几个向量或矩阵，同样必须预先规定好大小：</p>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">RowVectorXd <span class="title">vec1</span><span class="params">(<span class="number">3</span>)</span></span>;</span><br><span class="line">	vec1 &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;vec1 = &quot;</span> &lt;&lt; vec1 &lt;&lt; endl;</span><br><span class="line"> </span><br><span class="line">	<span class="function">RowVectorXd <span class="title">vec2</span><span class="params">(<span class="number">4</span>)</span></span>;</span><br><span class="line">	vec2 &lt;&lt; <span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;vec2 = &quot;</span> &lt;&lt; vec2 &lt;&lt; endl;</span><br><span class="line"> </span><br><span class="line">	<span class="function">RowVectorXd <span class="title">joined</span><span class="params">(<span class="number">7</span>)</span></span>;</span><br><span class="line">	joined &lt;&lt; vec1, vec2;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;joined = &quot;</span> &lt;&lt; joined &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vec1 = 1 2 3</span><br><span class="line">vec2 =  1  4  9 16</span><br><span class="line">joined =  1  2  3  1  4  9 16</span><br></pre></td></tr></table></figure>
<ul>
<li>可以用同样的方法按块结构初始化矩阵：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">MatrixXf <span class="title">matA</span><span class="params">(<span class="number">2</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">	matA &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>;</span><br><span class="line">	<span class="function">MatrixXf <span class="title">matB</span><span class="params">(<span class="number">4</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">	matB &lt;&lt; matA, matA/<span class="number">10</span>, matA/<span class="number">10</span>, matA;</span><br><span class="line">	cout &lt;&lt; matB &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">1</span>   <span class="number">2</span> <span class="number">0.1</span> <span class="number">0.2</span></span><br><span class="line">  <span class="number">3</span>   <span class="number">4</span> <span class="number">0.3</span> <span class="number">0.4</span></span><br><span class="line"><span class="number">0.1</span> <span class="number">0.2</span>   <span class="number">1</span>   <span class="number">2</span></span><br><span class="line"><span class="number">0.3</span> <span class="number">0.4</span>   <span class="number">3</span>   <span class="number">4</span></span><br></pre></td></tr></table></figure>
<ul>
<li>逗号初始化也可以用来为块表达式赋值：</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Matrix3f m;</span><br><span class="line">	m.<span class="built_in">row</span>(<span class="number">0</span>) &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>;</span><br><span class="line">	m.<span class="built_in">block</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">2</span>) &lt;&lt; <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>;</span><br><span class="line">	m.<span class="built_in">col</span>(<span class="number">2</span>).<span class="built_in">tail</span>(<span class="number">2</span>) &lt;&lt; <span class="number">6</span>, <span class="number">9</span>;                   </span><br><span class="line">	cout &lt;&lt; m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br></pre></td></tr></table></figure>
<h3 id="特殊矩阵与数组"><a href="#特殊矩阵与数组" class="headerlink" title="特殊矩阵与数组"></a>特殊矩阵与数组</h3><p>参考手册 <a target="_blank" rel="noopener" href="http://eigen.tuxfamily.org/dox/group__QuickRefPage.html#title3">Quick Reference Guide - Predefined Matrices</a> </p>
<h4 id="Zero"><a href="#Zero" class="headerlink" title="Zero()"></a>Zero()</h4><p>初始化所有系数为0，共有三种形式：</p>
<ul>
<li><code>Zero()</code> : 不接收任何变量，仅用于固定大小的对象；</li>
<li><code>Zero(size)</code> : 接收一个变量，仅用于一维动态大小的对象；</li>
<li><code>Zero(rows,cols)</code> : 接收两个变量，仅用于二维动态大小的对象。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;A fixed-size array:\n&quot;</span>;</span><br><span class="line">	Array33f a1 = Array33f::<span class="built_in">Zero</span>();</span><br><span class="line">	cout &lt;&lt; a1 &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;A one-dimensional dynamic-size array:\n&quot;</span>;</span><br><span class="line">	ArrayXf a2 = ArrayXf::<span class="built_in">Zero</span>(<span class="number">3</span>);</span><br><span class="line">	cout &lt;&lt; a2 &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;A two-dimensional dynamic-size array:\n&quot;</span>;</span><br><span class="line">	ArrayXXf a3 = ArrayXXf::<span class="built_in">Zero</span>(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">	cout &lt;&lt; a3 &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">A fixed-size array:</span><br><span class="line">0 0 0</span><br><span class="line">0 0 0</span><br><span class="line">0 0 0</span><br><span class="line"></span><br><span class="line">A one-dimensional dynamic-size array:</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">A two-dimensional dynamic-size array:</span><br><span class="line">0 0 0 0</span><br><span class="line">0 0 0 0</span><br><span class="line">0 0 0 0</span><br></pre></td></tr></table></figure>
<h4 id="Ones"><a href="#Ones" class="headerlink" title="Ones()"></a>Ones()</h4><p>初始化所有系数为1，三种形式与 <code>Zero()</code> 相同</p>
<h4 id="Random"><a href="#Random" class="headerlink" title="Random()"></a>Random()</h4><p>初始化所有系数为随机数，三种形式与 <code>Zero()</code> 相同</p>
<h4 id="Constant-value"><a href="#Constant-value" class="headerlink" title="Constant(value)"></a>Constant(value)</h4><p>初始化所有系数为value，同样三种形式：</p>
<ul>
<li><code>Constant(value)</code></li>
<li><code>Constant(size,value)</code></li>
<li><code>Constant(rows,cols,value)</code> </li>
</ul>
<h4 id="Identity"><a href="#Identity" class="headerlink" title="Identity()"></a>Identity()</h4><p>返回单位矩阵，仅用于 Matrix 类，包括 <code>Identity()</code> 和 <code>Identity(rows,cols)</code> </p>
<h4 id="LinSpaced-size-low-high"><a href="#LinSpaced-size-low-high" class="headerlink" title="LinSpaced(size, low, high)"></a>LinSpaced(size, low, high)</h4><p>仅用于向量或一维数组，返回一个指定大小的向量，其系数在参数 <code>low</code> 和 <code>high</code> 之间等距分布</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">ArrayXXf <span class="title">table</span><span class="params">(<span class="number">10</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">	table.<span class="built_in">col</span>(<span class="number">0</span>) = ArrayXf::<span class="built_in">LinSpaced</span>(<span class="number">10</span>, <span class="number">0</span>, <span class="number">90</span>);</span><br><span class="line">	table.<span class="built_in">col</span>(<span class="number">1</span>) = M_PI / <span class="number">180</span> * table.<span class="built_in">col</span>(<span class="number">0</span>);</span><br><span class="line">	table.<span class="built_in">col</span>(<span class="number">2</span>) = table.<span class="built_in">col</span>(<span class="number">1</span>).<span class="built_in">sin</span>();</span><br><span class="line">	table.<span class="built_in">col</span>(<span class="number">3</span>) = table.<span class="built_in">col</span>(<span class="number">1</span>).<span class="built_in">cos</span>();</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;  Degrees   Radians      Sine    Cosine\n&quot;</span>;</span><br><span class="line">	cout &lt;&lt; table &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Degrees   Radians      Sine    Cosine</span><br><span class="line">      0         0         0         1</span><br><span class="line">     10     0.175     0.174     0.985</span><br><span class="line">     20     0.349     0.342      0.94</span><br><span class="line">     30     0.524       0.5     0.866</span><br><span class="line">     40     0.698     0.643     0.766</span><br><span class="line">     50     0.873     0.766     0.643</span><br><span class="line">     60      1.05     0.866       0.5</span><br><span class="line">     70      1.22      0.94     0.342</span><br><span class="line">     80       1.4     0.985     0.174</span><br><span class="line">     90      1.57         1 -4.37e-08</span><br></pre></td></tr></table></figure>
<p>从这些例子可以看出，上述方法都会返回一个矩阵或数组再赋值给变量（或表达式），方便起见，Eigen还定义了一些函数来方便地执行这些操作，例如 <code>setZero()</code>  <code>MatrixBase::setIdentity()</code>  <code>DenseBase::setLinSpaced()</code> 等。下面这个例程展示了如何使用静态方法、逗号初始化和 <code>setXxx()</code> 函数来初始化矩阵：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> size = <span class="number">6</span>;</span><br><span class="line"><span class="function">MatrixXd <span class="title">mat1</span><span class="params">(size, size)</span></span>;</span><br><span class="line">mat1.<span class="built_in">topLeftCorner</span>(size/<span class="number">2</span>, size/<span class="number">2</span>)     = MatrixXd::<span class="built_in">Zero</span>(size/<span class="number">2</span>, size/<span class="number">2</span>);</span><br><span class="line">mat1.<span class="built_in">topRightCorner</span>(size/<span class="number">2</span>, size/<span class="number">2</span>)    = MatrixXd::<span class="built_in">Identity</span>(size/<span class="number">2</span>, size/<span class="number">2</span>);</span><br><span class="line">mat1.<span class="built_in">bottomLeftCorner</span>(size/<span class="number">2</span>, size/<span class="number">2</span>)  = MatrixXd::<span class="built_in">Identity</span>(size/<span class="number">2</span>, size/<span class="number">2</span>);</span><br><span class="line">mat1.<span class="built_in">bottomRightCorner</span>(size/<span class="number">2</span>, size/<span class="number">2</span>) = MatrixXd::<span class="built_in">Zero</span>(size/<span class="number">2</span>, size/<span class="number">2</span>);</span><br><span class="line">std::cout &lt;&lt; mat1 &lt;&lt; std::endl &lt;&lt; std::endl;</span><br><span class="line"> </span><br><span class="line"><span class="function">MatrixXd <span class="title">mat2</span><span class="params">(size, size)</span></span>;</span><br><span class="line">mat2.<span class="built_in">topLeftCorner</span>(size/<span class="number">2</span>, size/<span class="number">2</span>).<span class="built_in">setZero</span>();</span><br><span class="line">mat2.<span class="built_in">topRightCorner</span>(size/<span class="number">2</span>, size/<span class="number">2</span>).<span class="built_in">setIdentity</span>();</span><br><span class="line">mat2.<span class="built_in">bottomLeftCorner</span>(size/<span class="number">2</span>, size/<span class="number">2</span>).<span class="built_in">setIdentity</span>();</span><br><span class="line">mat2.<span class="built_in">bottomRightCorner</span>(size/<span class="number">2</span>, size/<span class="number">2</span>).<span class="built_in">setZero</span>();</span><br><span class="line">std::cout &lt;&lt; mat2 &lt;&lt; std::endl &lt;&lt; std::endl;</span><br><span class="line"> </span><br><span class="line"><span class="function">MatrixXd <span class="title">mat3</span><span class="params">(size, size)</span></span>;</span><br><span class="line">mat3 &lt;&lt; MatrixXd::<span class="built_in">Zero</span>(size/<span class="number">2</span>, size/<span class="number">2</span>), MatrixXd::<span class="built_in">Identity</span>(size/<span class="number">2</span>, size/<span class="number">2</span>),</span><br><span class="line">        MatrixXd::<span class="built_in">Identity</span>(size/<span class="number">2</span>, size/<span class="number">2</span>), MatrixXd::<span class="built_in">Zero</span>(size/<span class="number">2</span>, size/<span class="number">2</span>);</span><br><span class="line">std::cout &lt;&lt; mat3 &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">0 0 0 1 0 0</span><br><span class="line">0 0 0 0 1 0</span><br><span class="line">0 0 0 0 0 1</span><br><span class="line">1 0 0 0 0 0</span><br><span class="line">0 1 0 0 0 0</span><br><span class="line">0 0 1 0 0 0</span><br><span class="line"></span><br><span class="line">0 0 0 1 0 0</span><br><span class="line">0 0 0 0 1 0</span><br><span class="line">0 0 0 0 0 1</span><br><span class="line">1 0 0 0 0 0</span><br><span class="line">0 1 0 0 0 0</span><br><span class="line">0 0 1 0 0 0</span><br><span class="line"></span><br><span class="line">0 0 0 1 0 0</span><br><span class="line">0 0 0 0 1 0</span><br><span class="line">0 0 0 0 0 1</span><br><span class="line">1 0 0 0 0 0</span><br><span class="line">0 1 0 0 0 0</span><br><span class="line">0 0 1 0 0 0</span><br></pre></td></tr></table></figure>
<p>除此之外，Eigen还定义了一些用于生成基向量的方法：</p>
<ul>
<li><code>Vector3f::UnitX()</code> : (1, 0, 0)</li>
<li><code>Vector3f::UnitY()</code> : (0, 1, 0)</li>
<li><code>Vector3f::UnitZ()</code> : (0, 0, 1)</li>
<li><code>VectorXf::Unit(size,i)</code> : <ul>
<li>例如 ：<code>VectorXf::Unit(4,1)</code> == <code>Vector4f(0,1,0,0)</code> == <code>Vector4f::UnitY()</code> </li>
</ul>
</li>
</ul>
<h3 id="用作临时对象"><a href="#用作临时对象" class="headerlink" title="用作临时对象"></a>用作临时对象</h3><p>无论是逗号初始化程序还是上面介绍的几种类内静态方法，都可以用作表达式中的临时对象。</p>
<p>逗号初始化程序用作临时对象时，需要调用 <code>finished()</code> 方法获取实际的矩阵对象。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	MatrixXd m = MatrixXd::<span class="built_in">Random</span>(<span class="number">3</span>,<span class="number">3</span>);</span><br><span class="line">    m = (m + MatrixXd::<span class="built_in">Constant</span>(<span class="number">3</span>,<span class="number">3</span>,<span class="number">1.2</span>)) * <span class="number">50</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m =&quot;</span> &lt;&lt; endl &lt;&lt; m &lt;&lt; endl;</span><br><span class="line">    <span class="function">VectorXd <span class="title">v</span><span class="params">(<span class="number">3</span>)</span></span>;</span><br><span class="line">    v &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m * v =&quot;</span> &lt;&lt; endl &lt;&lt; m * v &lt;&lt; endl;</span><br><span class="line">    MatrixXf mat = MatrixXf::<span class="built_in">Random</span>(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;mat =\n&quot;</span> &lt;&lt; mat &lt;&lt; endl;</span><br><span class="line">	mat = (<span class="built_in">MatrixXf</span>(<span class="number">2</span>,<span class="number">2</span>) &lt;&lt; <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>).<span class="built_in">finished</span>() * mat;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;mat =\n&quot;</span> &lt;&lt; mat &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">m =</span><br><span class="line">  10 55.9 14.7</span><br><span class="line">23.2 63.3 77.9</span><br><span class="line">85.6 31.9 77.9</span><br><span class="line">m * v =</span><br><span class="line">166</span><br><span class="line">383</span><br><span class="line">383</span><br><span class="line">mat =</span><br><span class="line">     -1   0.511  0.0655</span><br><span class="line"> -0.737 -0.0827  -0.562</span><br><span class="line">mat =</span><br><span class="line"> -0.737 -0.0827  -0.562</span><br><span class="line">     -1   0.511  0.0655</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/Eigen/%E5%9D%97%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Eigen/%E5%9D%97%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">块操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-22 10:38:08" itemprop="dateCreated datePublished" datetime="2021-04-22T10:38:08+08:00">2021-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-23 15:38:45" itemprop="dateModified" datetime="2021-04-23T15:38:45+08:00">2021-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Eigen/" itemprop="url" rel="index"><span itemprop="name">Eigen</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本章介绍 Matrix 和 Array 中的块操作。</p>
<h3 id="块操作-block"><a href="#块操作-block" class="headerlink" title="块操作 .block()"></a>块操作 .block()</h3><p>取一个从 <code>(i,j)</code> 开始的，大小为 <code>(p,q)</code> 的块，有两种语法：</p>
<ul>
<li><code>matrix.block(i,j,p,q);</code> =&gt; 构造一个动态大小的块</li>
<li><code>matrix.block&lt;p,q&gt;(i,j);</code> =&gt; 构造一个固定大小的块</li>
</ul>
<p>两种语法的执行结果相同，都能用在固定大小/动态大小的矩阵/数组上。唯一不同的是当块大小已知且比较小的时候，返回固定大小的块能让代码执行得更快一点。</p>
<p>尽管 <code>.block()</code> 方法可以用于任何块操作，但对于特殊情况，使用更具针对性的方法能提供更好的性能，下面将介绍三种特殊方法。</p>
<h3 id="行列操作"><a href="#行列操作" class="headerlink" title="行列操作"></a>行列操作</h3><ul>
<li>取第 <code>i</code> 行：<code>matrix.row(i)</code> </li>
<li>取第 <code>j</code> 列：<code>matrix.col(j)</code> </li>
</ul>
<h3 id="与角相关的操作"><a href="#与角相关的操作" class="headerlink" title="与角相关的操作"></a>与角相关的操作</h3><p>同样也有返回动态大小/固定大小两种语法</p>
<ul>
<li>左上角 <code>p*q</code> ：<code>matrix.topLeftCorner(p,q);</code>     <code>matrix.topLeftCorner&lt;p,q&gt;();</code> </li>
<li>左下角 <code>p*q</code> ：<code>matrix.bottomLeftCorner(p,q);</code>     <code>matrix.bottomLeftCorner&lt;p,q&gt;();</code></li>
<li>右上角 <code>p*q</code> ：<code>matrix.topRightCorner(p,q);</code>     <code>matrix.topRightCorner&lt;p,q&gt;();</code> </li>
<li>右下角 <code>p*q</code> ：<code>matrix.bottomRightCorner(p,q);</code>     <code>matrix.bottomRightCorner&lt;p,q&gt;();</code>  </li>
<li>取前 <code>q</code> 行：<code>matrix.topRows(q);</code>     <code>matrix.topRows&lt;q&gt;();</code> </li>
<li>取后 <code>q</code> 行：<code>matrix.bottomRows(q);</code>     <code>matrix.bottomRows&lt;q&gt;();</code> </li>
<li>取前 <code>p</code> 列：<code>matrix.leftCols(p);</code>     <code>matrix.leftCols&lt;p&gt;();</code> </li>
<li>取后 <code>p</code> 列：<code>matrix.rightCols(q);</code>     <code>matrix.rightCols&lt;q&gt;();</code> </li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Eigen::Matrix4f m;</span><br><span class="line">    m &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>,</span><br><span class="line">         <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>,</span><br><span class="line">         <span class="number">9</span>, <span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,</span><br><span class="line">         <span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m.leftCols(2) =&quot;</span> &lt;&lt; endl </span><br><span class="line">         &lt;&lt; m.<span class="built_in">leftCols</span>(<span class="number">2</span>) &lt;&lt; endl </span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m.bottomRows&lt;2&gt;() =&quot;</span> &lt;&lt; endl </span><br><span class="line">         &lt;&lt; m.bottomRows&lt;<span class="number">2</span>&gt;() &lt;&lt; endl </span><br><span class="line">         &lt;&lt; endl;</span><br><span class="line">    m.<span class="built_in">topLeftCorner</span>(<span class="number">1</span>,<span class="number">3</span>) = m.<span class="built_in">bottomRightCorner</span>(<span class="number">3</span>,<span class="number">1</span>).<span class="built_in">transpose</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;After assignment, m = &quot;</span> &lt;&lt; endl &lt;&lt; m &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">m.leftCols(2) =</span><br><span class="line"> 1  2</span><br><span class="line"> 5  6</span><br><span class="line"> 9 10</span><br><span class="line">13 14</span><br><span class="line"></span><br><span class="line">m.bottomRows&lt;2&gt;() =</span><br><span class="line"> 9 10 11 12</span><br><span class="line">13 14 15 16</span><br><span class="line"></span><br><span class="line">After assignment, m = </span><br><span class="line"> 8 12 16  4</span><br><span class="line"> 5  6  7  8</span><br><span class="line"> 9 10 11 12</span><br><span class="line">13 14 15 16</span><br></pre></td></tr></table></figure>
<h3 id="对向量和一维数组的块操作"><a href="#对向量和一维数组的块操作" class="headerlink" title="对向量和一维数组的块操作"></a>对向量和一维数组的块操作</h3><p>同样也有返回动态大小/固定大小两种语法</p>
<ul>
<li>包含前 <code>n</code> 个元素：<code>vector.head(n);</code>     <code>vector.head&lt;n&gt;();</code> </li>
<li>包含后 <code>n</code> 个元素：<code>vector.tail(n);</code>     <code>vector.tail&lt;n&gt;();</code> </li>
<li>从 <code>i</code> 开始，包含 <code>n</code> 个元素：<code>vector.segment(i,n);</code>     <code>vector.segment&lt;n&gt;(i);</code> </li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">Eigen::ArrayXf <span class="title">v</span><span class="params">(<span class="number">6</span>)</span></span>;</span><br><span class="line">    v &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;v.head(3) =&quot;</span> &lt;&lt; endl &lt;&lt; v.<span class="built_in">head</span>(<span class="number">3</span>) &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;v.tail&lt;3&gt;() = &quot;</span> &lt;&lt; endl &lt;&lt; v.tail&lt;<span class="number">3</span>&gt;() &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line">    v.<span class="built_in">segment</span>(<span class="number">1</span>,<span class="number">4</span>) *= <span class="number">2</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;after &#x27;v.segment(1,4) *= 2&#x27;, v =&quot;</span> &lt;&lt; endl &lt;&lt; v &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">v.head(3) =</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">v.tail&lt;3&gt;() = </span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line"></span><br><span class="line">after <span class="string">&#x27;v.segment(1,4) *= 2&#x27;</span>, v =</span><br><span class="line"> 1</span><br><span class="line"> 4</span><br><span class="line"> 6</span><br><span class="line"> 8</span><br><span class="line">10</span><br><span class="line"> 6</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/Eigen/Array%E7%B1%BB%E4%B8%8E%E7%B3%BB%E6%95%B0%E7%BA%A7%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Eigen/Array%E7%B1%BB%E4%B8%8E%E7%B3%BB%E6%95%B0%E7%BA%A7%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">Array类与系数级操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-22 09:59:39" itemprop="dateCreated datePublished" datetime="2021-04-22T09:59:39+08:00">2021-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-23 15:40:17" itemprop="dateModified" datetime="2021-04-23T15:40:17+08:00">2021-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Eigen/" itemprop="url" rel="index"><span itemprop="name">Eigen</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本章介绍Eigen中的Array类。</p>
<p>Matrix类主要面向线性代数，Array类则提供更普遍意义上的数组操作，允许进行没有具体线代意义的系数级运算，例如给每个系数加上一个常数，或将两个数组按系数相乘等。</p>
<h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><p>Array的六个模板参数和Matrix一模一样，并且也定义了一些常用类型</p>
<ul>
<li><code>ArrayNt</code> ：表示一个一维数组，<code>N</code> 为数组大小，<code>t</code> 为数值类型</li>
<li><code>ArrayNNt</code> ：表示一个二维数组</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Array&lt;<span class="keyword">float</span>, Dynamic, <span class="number">1</span>&gt; ArrayXf;</span><br><span class="line"><span class="keyword">typedef</span> Array&lt;<span class="keyword">float</span>, <span class="number">3</span>, <span class="number">1</span>&gt; Array3f;</span><br><span class="line"><span class="keyword">typedef</span> Array&lt;<span class="keyword">double</span>, Dynamic, Dynamic&gt; ArrayXXd;</span><br><span class="line"><span class="keyword">typedef</span> Array&lt;<span class="keyword">double</span>, <span class="number">3</span>, <span class="number">3</span>&gt; Array33d;</span><br></pre></td></tr></table></figure>
<h3 id="访问系数"><a href="#访问系数" class="headerlink" title="访问系数"></a>访问系数</h3><p>与Matrix相同，Array也是通过重载括号运算符 <code>()</code> 实现对数组系数的读写操作；重载 <code>&lt;&lt;</code> 操作符逗号初始化数组或打印数组。</p>
<h3 id="加减法"><a href="#加减法" class="headerlink" title="加减法"></a>加减法</h3><p>与Matrix相同，当两个数组大小相同时操作有效，且加减法按系数进行；</p>
<p>与Matrix不同，Array也支持 <code>array+scalar</code> 的操作，即向Array中的每个系数加上同一个常数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="function">ArrayXXf <span class="title">a</span><span class="params">(<span class="number">3</span>,<span class="number">3</span>)</span></span>;</span><br><span class="line">  <span class="function">ArrayXXf <span class="title">b</span><span class="params">(<span class="number">3</span>,<span class="number">3</span>)</span></span>;</span><br><span class="line">  a &lt;&lt; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">       <span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,</span><br><span class="line">       <span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>;</span><br><span class="line">  b &lt;&lt; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">       <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">       <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>;</span><br><span class="line">       </span><br><span class="line">  <span class="comment">// Adding two arrays</span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;a + b = &quot;</span> &lt;&lt; endl &lt;&lt; a + b &lt;&lt; endl &lt;&lt; endl;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// Subtracting a scalar from an array</span></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;a - 2 = &quot;</span> &lt;&lt; endl &lt;&lt; a - <span class="number">2</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a + b = </span><br><span class="line"> 2  4  6</span><br><span class="line"> 5  7  9</span><br><span class="line"> 8 10 12</span><br><span class="line"></span><br><span class="line">a - 2 = </span><br><span class="line">-1  0  1</span><br><span class="line"> 2  3  4</span><br><span class="line"> 5  6  7</span><br></pre></td></tr></table></figure>
<h3 id="乘法"><a href="#乘法" class="headerlink" title="乘法"></a>乘法</h3><ul>
<li><code>array * scalar</code> 或 <code>scalar * array</code> ：同Matrix</li>
<li><code>array * array</code> ：与Matrix不同。Matrix进行的是矩阵乘法，Array则是系数对应相乘。因此当且仅当两个数组维度相同时，才能相乘。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="function">ArrayXXf <span class="title">a</span><span class="params">(<span class="number">2</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">  <span class="function">ArrayXXf <span class="title">b</span><span class="params">(<span class="number">2</span>,<span class="number">2</span>)</span></span>;</span><br><span class="line">  a &lt;&lt; <span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">       <span class="number">3</span>,<span class="number">4</span>;</span><br><span class="line">  b &lt;&lt; <span class="number">5</span>,<span class="number">6</span>,</span><br><span class="line">       <span class="number">7</span>,<span class="number">8</span>;</span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;a * b = &quot;</span> &lt;&lt; endl &lt;&lt; a * b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a * b = </span><br><span class="line"> <span class="number">5</span> <span class="number">12</span></span><br><span class="line"><span class="number">21</span> <span class="number">32</span></span><br></pre></td></tr></table></figure>
<h3 id="其他系数级操作"><a href="#其他系数级操作" class="headerlink" title="其他系数级操作"></a>其他系数级操作</h3><p>参考Eigen手册 <a target="_blank" rel="noopener" href="http://eigen.tuxfamily.org/dox/group__QuickRefPage.html#title6">Quick Reference Guide : Coefficient-wise &amp; Array operators</a>  </p>
<h3 id="Array-与-Matrix-类型转换"><a href="#Array-与-Matrix-类型转换" class="headerlink" title="Array 与 Matrix 类型转换"></a>Array 与 Matrix 类型转换</h3><ul>
<li>Array -&gt; Matrix : <code>A.matrix()</code> </li>
<li>Matrix -&gt; Array : <code>M.array()</code> </li>
</ul>
<p>Eigen禁止在一个表达式中混用Array和Matrix，唯一例外的是 <code>赋值运算</code> ，它允许Array和Matrix的互相赋值。</p>
<p>Eigen也为Matrix提供了一些 <code>cwise*()</code> 的方法使其允许直接进行系数级操作，类似 <code>.array().*()</code> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/Eigen/%E5%90%91%E9%87%8F%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Eigen/%E5%90%91%E9%87%8F%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97/" class="post-title-link" itemprop="url">向量矩阵运算</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-21 12:57:57" itemprop="dateCreated datePublished" datetime="2021-04-21T12:57:57+08:00">2021-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-23 15:40:54" itemprop="dateModified" datetime="2021-04-23T15:40:54+08:00">2021-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Eigen/" itemprop="url" rel="index"><span itemprop="name">Eigen</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这章介绍Eigen中矩阵、向量和标量之间的运算。对Matrix类，运算符重载仅支持线性代数运算，例如矩阵x矩阵，而像向量+标量的操作是不允许的。Array类则允许执行所有的数组操作，见 <strong>The Array Class and Coefficient-wise Operations</strong> 。</p>
<h3 id="加减法"><a href="#加减法" class="headerlink" title="加减法"></a>加减法</h3><p>Eigen不会自动执行类型转换，所以左右维度和数值类型必须保证相同。可用的操作符包括：</p>
<ul>
<li>一元操作符 <code>-</code> : -a</li>
<li>二元操作符 <code>+</code> <code>-</code> : a+b, a-b</li>
<li>复合操作符 <code>+=</code> <code>-=</code> : a+=b, a-=b</li>
</ul>
<h3 id="标量乘除"><a href="#标量乘除" class="headerlink" title="标量乘除"></a>标量乘除</h3><p>矩阵所有系数乘/除以该标量。可用操作符包括：</p>
<ul>
<li>二元操作符 <code>*</code> : matrix <em> scalar, scalar </em> matrix</li>
<li>二元操作符 <code>/</code> : matrix / scalar</li>
<li>复合操作符 <code>*=</code> <code>/=</code> : matrix *= scalar, matrix /= scalar</li>
</ul>
<h3 id="转置与共轭"><a href="#转置与共轭" class="headerlink" title="转置与共轭"></a>转置与共轭</h3><ul>
<li><code>transpose()</code> : $\boldsymbol{a}^T$ （转置）</li>
<li><code>conjugate()</code>  : $\overline{\boldsymbol{a}}$  （共轭）</li>
<li><code>adjoint()</code> : $\boldsymbol{a}^*$     （共轭转置）</li>
</ul>
<p>显然，对实矩阵而言，<code>conjugate()</code> 并不执行什么操作，所以 <code>adjoint()</code> 完全等同于 <code>transpose()</code> 。</p>
<p>需要<strong>非常注意</strong>的一点是，基本运算符 <code>transpose()</code> 和 <code>adjoint()</code> 仅仅返回一个代理对象，而并未进行实质的运算。例如，执行 <code>b = a.transpose()</code> 时，Eigen在将结果写入b的同时执行转置；从而引出另一个问题，如果执行 <code>a = a.transpose()</code> ，Eigen同样会在转置完成前开始将结果写入矩阵a，因此这句话不会像预期一样将a变为它的转置，反而会在执行过程中得到 <code>aliasing issue</code> </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Eigen::Matrix3i a;</span><br><span class="line">    Eigen::Matrix3i b;</span><br><span class="line">    a &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;origin matrix a:\n&quot;</span></span><br><span class="line">         &lt;&lt; a &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    b = a.<span class="built_in">transpose</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;b as the transpose of matrix a:\n&quot;</span></span><br><span class="line">         &lt;&lt; b &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    a = a.<span class="built_in">transpose</span>(); <span class="comment">// !!! DO NOT DO THIS !!!</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Here is the result of the aliasing effect:\n&quot;</span></span><br><span class="line">         &lt;&lt; a &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">origin matrix a:</span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br><span class="line">b as the transpose of matrix a:</span><br><span class="line">1 4 7</span><br><span class="line">2 5 8</span><br><span class="line">3 6 9</span><br><span class="line">main: /usr/include/eigen3/Eigen/src/Core/Transpose.h:378: static void Eigen::internal::checkTransposeAliasing_impl&lt;Derived, OtherDerived, MightHaveTransposeAliasing&gt;::run(const Derived&amp;, const OtherDerived&amp;) [with Derived = Eigen::Matrix&lt;int, 3, 3&gt;; OtherDerived = Eigen::Transpose&lt;Eigen::Matrix&lt;int, 3, 3&gt; &gt;; bool MightHaveTransposeAliasing = <span class="literal">true</span>]: Assertion `(!check_transpose_aliasing_run_time_selector &lt;typename Derived::Scalar,blas_traits&lt;Derived&gt;::IsTransposed,OtherDerived&gt; ::run(extract_data(dst), other)) &amp;&amp; <span class="string">&quot;aliasing detected during transposition, use transposeInPlace() &quot;</span> <span class="string">&quot;or evaluate the rhs into a temporary using .eval()&quot;</span><span class="string">&#x27; failed.</span></span><br><span class="line"><span class="string">Aborted (core dumped)</span></span><br></pre></td></tr></table></figure>
<p>所谓<strong>混叠问题</strong>，即 <code>aliasing issue</code> ，指的是在赋值表达式的左右两边存在矩阵的重叠区域，这种情况下，有可能得到非预期的结果，具体见 <strong>Aliasing</strong> 。</p>
<p>如果想执行就地转置（in-place transposition），调用 <code>transposeInPlace()</code> 方法：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="built_in">transposeInPlace</span>();</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;After being transposed:\n&quot;</span></span><br><span class="line">     &lt;&lt; a &lt;&lt; endl;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">After being transposed:</span><br><span class="line">1 4 7</span><br><span class="line">2 5 8</span><br><span class="line">3 6 9</span><br></pre></td></tr></table></figure>
<p>同理，也有为复矩阵准备的就地共轭转置 <code>adjointInPlace()</code> 方法</p>
<h3 id="矩阵-矩阵乘法乘法"><a href="#矩阵-矩阵乘法乘法" class="headerlink" title="矩阵-矩阵乘法乘法"></a>矩阵-矩阵乘法乘法</h3><p>向量是一种特殊的矩阵，因此矩阵-向量、向量-向量乘法也包括其中。可用操作符有：</p>
<ul>
<li>二元操作符 <code>*</code> : a*b</li>
<li>复合操作符 <code>*=</code> : a*=b</li>
</ul>
<p>执行操作 <code>m = m * m</code> 是安全的，因为Eigen将矩阵乘法当作一种特殊形式进行处理，会在编译时引入一个临时变量，所以不必担心会出现 <code>aliasing issue</code>：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmp = m * m;</span><br><span class="line">m = tmp;</span><br></pre></td></tr></table></figure>
<p>当然，如果你很清楚自己的矩阵乘法不会有引起 <code>aliasing issue</code> 的可能，也可以调用 <code>noalias()</code> 方法来避免引入临时变量：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.<span class="built_in">noalias</span>() += a*b;</span><br></pre></td></tr></table></figure>
<h3 id="向量点乘和叉乘"><a href="#向量点乘和叉乘" class="headerlink" title="向量点乘和叉乘"></a>向量点乘和叉乘</h3><p><code>dot()</code> 和 <code>corss()</code> 方法分别实现向量点乘和叉乘，当然，点乘也可以通过 <code>u.adjoint()*v</code> 实现，只不过返回的结果是个1x1的矩阵：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Vector3d <span class="title">v</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    <span class="function">Vector3d <span class="title">w</span><span class="params">(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Dot product: &quot;</span> &lt;&lt; v.<span class="built_in">dot</span>(w) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">double</span> dp = v.<span class="built_in">adjoint</span>() * w; <span class="comment">// automatic conversion of the inner product to a scalar</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Dot product via a matrix product: &quot;</span> &lt;&lt; dp &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Cross product:\n&quot;</span></span><br><span class="line">         &lt;&lt; v.<span class="built_in">cross</span>(w) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Dot product: 8</span><br><span class="line">Dot product via a matrix product: 8</span><br><span class="line">Cross product:</span><br><span class="line"> 1</span><br><span class="line">-2</span><br><span class="line"> 1</span><br></pre></td></tr></table></figure>
<p>需要<strong>非常注意</strong>的是，<font color="#ff0000">叉乘只能用于大小为3的向量 </font>；点乘则可用于任意大小的向量</p>
<h3 id="基本算数归约运算"><a href="#基本算数归约运算" class="headerlink" title="基本算数归约运算"></a>基本算数归约运算</h3><p>Eigen提供了一些归约运算（reduction operation），将给定的矩阵或向量归约为单个值，例如 <code>sum()</code> , <code>prod()</code> , <code>maxCoeff()</code> , <code>minCoeff()</code> , <code>trace()</code> 分别表示所有矩阵系数的和、积、最大值、最小值，以及矩阵的迹，矩阵的迹也可以通过 <code>m.diagonal().sum()</code> 求得。</p>
<p>通过向 <code>maxCoeff()</code> 或 <code>minCoeff()</code> 中传入 <code>std::ptrdiff_t</code> 类型的参数指针，可以得到对应最大值/最小值的坐标：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> Eigen;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Matrix3f m = Matrix3f::<span class="built_in">Random</span>();</span><br><span class="line">    std::<span class="keyword">ptrdiff_t</span> i, j;</span><br><span class="line">    <span class="keyword">float</span> minOfM = m.<span class="built_in">minCoeff</span>(&amp;i, &amp;j);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Here is the matrix m:\n&quot;</span></span><br><span class="line">         &lt;&lt; m &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Its minimum coefficient (&quot;</span> &lt;&lt; minOfM</span><br><span class="line">         &lt;&lt; <span class="string">&quot;) is at position (&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; j &lt;&lt; <span class="string">&quot;)\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    RowVector4i v = RowVector4i::<span class="built_in">Random</span>();</span><br><span class="line">    <span class="keyword">int</span> maxOfV = v.<span class="built_in">maxCoeff</span>(&amp;i);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Here is the vector v: &quot;</span> &lt;&lt; v &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Its maximum coefficient (&quot;</span> &lt;&lt; maxOfV</span><br><span class="line">         &lt;&lt; <span class="string">&quot;) is at position &quot;</span> &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Here is the matrix m:</span><br><span class="line"> 0.680375   0.59688 -0.329554</span><br><span class="line">-0.211234  0.823295  0.536459</span><br><span class="line"> 0.566198 -0.604897 -0.444451</span><br><span class="line">Its minimum coefficient (-0.604897) is at position (2,1)</span><br><span class="line"></span><br><span class="line">Here is the vector v:  115899597  -48539462  276748203 -290373134</span><br><span class="line">Its maximum coefficient (276748203) is at position 2</span><br></pre></td></tr></table></figure>
<h3 id="操作有效性"><a href="#操作有效性" class="headerlink" title="操作有效性"></a>操作有效性</h3><p>Eigen会在执行操作的时候检查有效性。</p>
<p>重要的编译错误信息会用大写突出出来。</p>
<p>但更多时候（例如检查动态大小的矩阵的操作），编译过程不会检查出错误。Eigen将在 <code>debug mode</code> 下使用 <code>runtime assertions</code> 让程序在运行过程中碰到非法操作的时候退出，同时报出错误信息。如果关掉assertions，程序很有可能会崩溃。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/Eigen/Matrix%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Eigen/Matrix%E7%B1%BB/" class="post-title-link" itemprop="url">Matrix类</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-20 13:30:03" itemprop="dateCreated datePublished" datetime="2021-04-20T13:30:03+08:00">2021-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-05-28 23:03:14" itemprop="dateModified" datetime="2021-05-28T23:03:14+08:00">2021-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Eigen/" itemprop="url" rel="index"><span itemprop="name">Eigen</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Eigen中所有矩阵和向量都是属于Matrix模板类的对象，<code>Vectors</code>是特殊的矩阵（一行或一列）</p>
<h3 id="Matrix前三个模板参数"><a href="#Matrix前三个模板参数" class="headerlink" title="Matrix前三个模板参数"></a>Matrix前三个模板参数</h3><p>虽然Matrix一共有六个模板参数，但目前暂时学前三个就够了，剩下三个参数有默认值，现在还用不到。Matrix的三个必需模板参数如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Matrix&lt;<span class="keyword">typename</span> Scalar, <span class="keyword">int</span> RowsAtCompileTime, <span class="keyword">int</span> ColsAtCompileTime&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>Scalar</code> ：矩阵参数的变量类型，如 <code>int</code> ,<code>float</code> ,<code>double</code> 等</p>
</li>
<li><p><code>RowsAtCompileTime</code> 和 <code>ColsAtCompileTime</code> ：矩阵的行数和列数</p>
<ul>
<li><p>特殊值 <strong>Dynamic</strong> ：表示矩阵维度未知</p>
<p>例如：<code>MatrixXd</code> 表示一个double类型的未知行列的矩阵</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Matrix&lt;<span class="keyword">double</span>, Dynamic, Dynamic&gt; MatrixXd;</span><br></pre></td></tr></table></figure>
<p>类似地，<code>VectorXi</code> 表示一个int类型的未知维度的向量</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Matrix&lt;<span class="keyword">int</span>, Dynamic, <span class="number">1</span>&gt; VectorXi;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Eigen中还提供了一些typedefs覆盖一些常用类型</p>
<ul>
<li><code>MatrixNt</code> ：即 <code>Matrix&lt;type, N, N&gt;</code>，例如 <code>Matrix4f</code> 表示4x4的float矩阵</li>
<li><code>VectorNt</code> ：即 <code>Matrix&lt;type, N, 1&gt;</code>，例如 <code>Vector4f</code> 表示4维的float列向量</li>
<li><code>RowVectorNt</code> ：即 <code>Matrix&lt;type, 1, N&gt;</code>，例如 <code>RowVector3d</code> 表示3维的double行向量</li>
<li>以上 <code>N</code> 可以是2，3，4或X（表示Dynamic），<code>t</code> 可以是 <code>i</code> (int), <code>f</code> (float), <code>d</code> (double), <code>cd</code> (complex\<float\>),  <code>cd</code> (complex\<double\>)等。</double\></float\></li>
</ul>
</li>
</ul>
<h3 id="向量类型"><a href="#向量类型" class="headerlink" title="向量类型"></a>向量类型</h3><p>列向量（最常用），列参数固定为1，例如 <code>Vector3f</code> 表示3维float列向量</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Matrix&lt;<span class="keyword">float</span>, <span class="number">3</span>, <span class="number">1</span>&gt; Vector3f;</span><br></pre></td></tr></table></figure>
<p>行向量，行参数固定为1，例如 <code>RowVector2i</code> 表示2维int行向量</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> Matrix&lt;<span class="keyword">int</span>, <span class="number">1</span>, <span class="number">2</span>&gt; RowVector2i;</span><br></pre></td></tr></table></figure>
<h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><h4 id="默认构造函数"><a href="#默认构造函数" class="headerlink" title="默认构造函数"></a>默认构造函数</h4><p>不执行动态内存分配，不初始化矩阵所有系数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Matrix3f a;</span><br><span class="line">MatrixXf b;</span><br></pre></td></tr></table></figure>
<ul>
<li>a是一个3x3矩阵，有一个未初始化的float[9]系数数组</li>
<li>b是一个动态大小的矩阵，当前大小为0x0，系数数组内存空间尚未分配</li>
</ul>
<h4 id="含维度的构造函数"><a href="#含维度的构造函数" class="headerlink" title="含维度的构造函数"></a>含维度的构造函数</h4><ol>
<li>矩阵类构造函数第一个参数为行数，第二个参数为列数：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">MatrixXf <span class="title">a</span><span class="params">(<span class="number">10</span>,<span class="number">15</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>a是一个10x15的动态大小矩阵，内存空间已分配，矩阵系数未初始化</li>
</ul>
<ol>
<li>向量类构造函数传入向量维数即可：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">VectorXf <span class="title">b</span><span class="params">(<span class="number">30</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>b是一个维度为30的动态大小向量，内存空间已分配，向量系数未初始化</li>
</ul>
<ol>
<li>在固定大小的矩阵上使用该构造函数是合法的，这是为了给固定大小和动态大小的矩阵提供相同的API接口，虽然这种行为并不会执行什么操作：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Matrix3f <span class="title">a</span><span class="params">(<span class="number">3</span>,<span class="number">3</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="固定维度向量-lt-4-允许直接初始化系数"><a href="#固定维度向量-lt-4-允许直接初始化系数" class="headerlink" title="固定维度向量(&lt;4)允许直接初始化系数"></a>固定维度向量(&lt;4)允许直接初始化系数</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Vector2d <span class="title">a</span><span class="params">(<span class="number">5.0</span>, <span class="number">6.0</span>)</span></span>;</span><br><span class="line"><span class="function">Vector3d <span class="title">b</span><span class="params">(<span class="number">5.0</span>, <span class="number">6.0</span>, <span class="number">7.0</span>)</span></span>;</span><br><span class="line"><span class="function">Vector4d <span class="title">c</span><span class="params">(<span class="number">5.0</span>, <span class="number">6.0</span>, <span class="number">7.0</span>, <span class="number">8.0</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="访问系数"><a href="#访问系数" class="headerlink" title="访问系数"></a>访问系数</h3><p>用括号访问/修改系数，矩阵先行后列，向量仅传下标即可</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Eigen::MatrixXd <span class="title">m</span><span class="params">(<span class="number">2</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="built_in">m</span>(<span class="number">0</span>, <span class="number">0</span>) = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">m</span>(<span class="number">1</span>, <span class="number">0</span>) = <span class="number">2.5</span>;</span><br><span class="line">    <span class="built_in">m</span>(<span class="number">0</span>, <span class="number">1</span>) = <span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">m</span>(<span class="number">1</span>, <span class="number">1</span>) = <span class="built_in">m</span>(<span class="number">1</span>, <span class="number">0</span>) + <span class="built_in">m</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Here is the matrix m:\n&quot;</span></span><br><span class="line">         &lt;&lt; m &lt;&lt; endl;</span><br><span class="line">    <span class="function">Eigen::Vector2d <span class="title">v</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="built_in">v</span>(<span class="number">0</span>) = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">v</span>(<span class="number">1</span>) = <span class="built_in">v</span>(<span class="number">0</span>) - <span class="number">1</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Here is the vector v:\n&quot;</span></span><br><span class="line">         &lt;&lt; v &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Here is matrix m(1):\n&quot;</span></span><br><span class="line">         &lt;&lt; <span class="built_in">m</span>(<span class="number">1</span>) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Here is matrix m(3):\n&quot;</span></span><br><span class="line">         &lt;&lt; <span class="built_in">m</span>(<span class="number">3</span>) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Here is the matrix m:</span><br><span class="line">  3  -1</span><br><span class="line">2.5 1.5</span><br><span class="line">Here is the vector v:</span><br><span class="line">4</span><br><span class="line">3</span><br><span class="line">Here is matrix m(1):</span><br><span class="line">2.5</span><br><span class="line">Here is matrix m(3):</span><br><span class="line">1.5</span><br></pre></td></tr></table></figure>
<ul>
<li><p>语法 <code>m(index)</code> 不仅适用于向量，对一般矩阵都适用，表示矩阵m在内存中存储的第index个元素，默认存储顺序为列优先，当然也可以修改为行有限，见 <strong>Storage Orders</strong> </p>
</li>
<li><p>操作符[]对向量重载，因为C++中[]只能容纳一个参数，所以只能向量使用，且 <code>matrix[i,j]</code> 将会被编译成 <code>matrix[j]</code> 并报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: static assertion failed: THE_BRACKET_OPERATOR_IS_ONLY_FOR_VECTORS__USE_THE_PARENTHESIS_OPERATOR_INSTEAD</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="逗号初始化"><a href="#逗号初始化" class="headerlink" title="逗号初始化"></a>逗号初始化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">m &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">    <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">    <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;m:\n&quot;</span></span><br><span class="line">     &lt;&lt; m &lt;&lt; endl;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m:</span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br></pre></td></tr></table></figure>
<p>更多介绍见 <strong>Advanced Initialization</strong> </p>
<h3 id="大小调整"><a href="#大小调整" class="headerlink" title="大小调整"></a>大小调整</h3><ol>
<li><p>调用 <code>rows()</code> <code>cols()</code> <code>size()</code> 方法获取矩阵行数、列数和系数个数</p>
</li>
<li><p>动态大小矩阵调用 <code>resize()</code> 方法调整大小。如果矩阵大小不发生变化，该方法不进行任何操作；否则它是破坏性的，矩阵系数可能被改变：</p>
</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Eigen::MatrixXd <span class="title">m</span><span class="params">(<span class="number">3</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    m &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">         <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">         <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;The matrix m is of size &quot;</span></span><br><span class="line">         &lt;&lt; m.<span class="built_in">rows</span>() &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; m.<span class="built_in">cols</span>()</span><br><span class="line">         &lt;&lt; <span class="string">&quot;, with &quot;</span> &lt;&lt; m.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; cofficients.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m:\n&quot;</span> &lt;&lt; m &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    m.<span class="built_in">resize</span>(<span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;After resize(4,4), the matrix m is of size &quot;</span></span><br><span class="line">         &lt;&lt; m.<span class="built_in">rows</span>() &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; m.<span class="built_in">cols</span>()</span><br><span class="line">         &lt;&lt; <span class="string">&quot;, with &quot;</span> &lt;&lt; m.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; cofficients.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m:\n&quot;</span> &lt;&lt; m &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">The matrix m is of size 3x3, with 9 cofficients.</span><br><span class="line">m:</span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br><span class="line">After resize(4,4), the matrix m is of size 4x4, with 16 cofficients.</span><br><span class="line">m:</span><br><span class="line">0 0 0 0</span><br><span class="line">0 0 0 0</span><br><span class="line">0 0 0 0</span><br><span class="line">0 0 0 0</span><br></pre></td></tr></table></figure>
<ol>
<li>如果想保持矩阵原有系数不变，调用 <code>conservativeResize()</code> 方法：</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Eigen::MatrixXd <span class="title">m</span><span class="params">(<span class="number">3</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    m &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;The matrix m is of size &quot;</span></span><br><span class="line">         &lt;&lt; m.<span class="built_in">rows</span>() &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; m.<span class="built_in">cols</span>()</span><br><span class="line">         &lt;&lt; <span class="string">&quot;, with &quot;</span> &lt;&lt; m.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; cofficients.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m:\n&quot;</span></span><br><span class="line">         &lt;&lt; m &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    m.<span class="built_in">conservativeResize</span>(<span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;After conservativeResize(4,4), the matrix m is of size &quot;</span></span><br><span class="line">         &lt;&lt; m.<span class="built_in">rows</span>() &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; m.<span class="built_in">cols</span>()</span><br><span class="line">         &lt;&lt; <span class="string">&quot;, with &quot;</span> &lt;&lt; m.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; cofficients.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m:\n&quot;</span></span><br><span class="line">         &lt;&lt; m &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    m.<span class="built_in">conservativeResize</span>(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;After conservativeResize(2,2), the matrix m is of size &quot;</span></span><br><span class="line">         &lt;&lt; m.<span class="built_in">rows</span>() &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; m.<span class="built_in">cols</span>()</span><br><span class="line">         &lt;&lt; <span class="string">&quot;, with &quot;</span> &lt;&lt; m.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; cofficients.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m:\n&quot;</span></span><br><span class="line">         &lt;&lt; m &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">The matrix m is of size 3x3, with 9 cofficients.</span><br><span class="line">m:</span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br><span class="line">After conservativeResize(4,4), the matrix m is of size 4x4, with 16 cofficients.</span><br><span class="line">m:</span><br><span class="line">1 2 3 0</span><br><span class="line">4 5 6 0</span><br><span class="line">7 8 9 0</span><br><span class="line">0 0 0 0</span><br><span class="line">After conservativeResize(2,2), the matrix m is of size 2x2, with 4 cofficients.</span><br><span class="line">m:</span><br><span class="line">1 2</span><br><span class="line">4 5</span><br></pre></td></tr></table></figure>
<ol>
<li>为了保证API的统一性，上述改变矩阵大小的方法也可以用于固定大小的矩阵类。resize到不同大小会触发 <code>assertion</code> 错误；resize到原本大小不会报错，也不会执行任何操作。</li>
</ol>
<h3 id="整体赋值"><a href="#整体赋值" class="headerlink" title="整体赋值"></a>整体赋值</h3><p>操作符 <code>=</code> 左边的矩阵会被自动resize到右边矩阵的大小，如果不希望这种自动resize发生，也可以将其禁用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;eigen3/Eigen/Eigen&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Eigen::MatrixXd <span class="title">m</span><span class="params">(<span class="number">3</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    m &lt;&lt; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;The matrix m is of size &quot;</span></span><br><span class="line">         &lt;&lt; m.<span class="built_in">rows</span>() &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; m.<span class="built_in">cols</span>()</span><br><span class="line">         &lt;&lt; <span class="string">&quot;, with &quot;</span> &lt;&lt; m.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; cofficients.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;m:\n&quot;</span></span><br><span class="line">         &lt;&lt; m &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="function">Eigen::MatrixXd <span class="title">n</span><span class="params">(<span class="number">2</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;The matrix n is of size &quot;</span></span><br><span class="line">         &lt;&lt; n.<span class="built_in">rows</span>() &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; n.<span class="built_in">cols</span>()</span><br><span class="line">         &lt;&lt; <span class="string">&quot;, with &quot;</span> &lt;&lt; n.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; cofficients.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;n:\n&quot;</span></span><br><span class="line">         &lt;&lt; n &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    n = m;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;After assignment, the matrix n is of size &quot;</span></span><br><span class="line">         &lt;&lt; n.<span class="built_in">rows</span>() &lt;&lt; <span class="string">&quot;x&quot;</span> &lt;&lt; n.<span class="built_in">cols</span>()</span><br><span class="line">         &lt;&lt; <span class="string">&quot;, with &quot;</span> &lt;&lt; n.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot; cofficients.&quot;</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;n:\n&quot;</span></span><br><span class="line">         &lt;&lt; n &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">The matrix m is of size 3x3, with 9 cofficients.</span><br><span class="line">m:</span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br><span class="line">The matrix n is of size 2x2, with 4 cofficients.</span><br><span class="line">n:</span><br><span class="line">0 0</span><br><span class="line">0 0</span><br><span class="line">After assignment, the matrix n is of size 3x3, with 9 cofficients.</span><br><span class="line">n:</span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br></pre></td></tr></table></figure>
<p>如果左侧为固定大小矩阵，编译不会报错。但如果大小与右侧不同，执行时会报错；相同则不会。</p>
<h3 id="固定大小-vs-动态大小"><a href="#固定大小-vs-动态大小" class="headerlink" title="固定大小 vs. 动态大小"></a>固定大小 vs. 动态大小</h3><p><strong>固定大小</strong>：适用于小矩阵(尤其是个数≤16的矩阵)。固定大小避免了动态内存分配并展开循环，有利于提高性能。实际上一个固定大小的Eigen矩阵只是一个简单的数组，即：执行 <code>Matrix4f m</code> 实际上就是在做 <code>float m[16]</code> 这件事，所以几乎不花时间。但需要注意的是，Eigen默认将数组自动分配为局部变量，这个操作在堆栈(stack)上完成，因此矩阵太大可能会导致堆栈溢出，并且矩阵太大(≥32)时，使用固定大小的性能优势就变得可以忽略不计了。</p>
<p><strong>动态大小</strong>：适用于大矩阵或不清楚具体维度的情况。与固定大小矩阵不同，它始终分配在堆(heap)上，即 <code>MatrixXf m(rows, cols)</code> 相当与执行 <code>float *m = new float[rows*cols]</code> ；除此之外，<code>MatrixXf</code> 对象还需要将行数、列数存储为成员变量。</p>
<h3 id="Matrix其他模板参数"><a href="#Matrix其他模板参数" class="headerlink" title="Matrix其他模板参数"></a>Matrix其他模板参数</h3><p>完整的 <code>Matrix</code> 模板类如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Matrix&lt;<span class="keyword">typename</span> Scalar,</span><br><span class="line">       <span class="keyword">int</span> RowsAtCompileTime,</span><br><span class="line">       <span class="keyword">int</span> ColsAtCompileTime,</span><br><span class="line">       <span class="keyword">int</span> Options = <span class="number">0</span>,</span><br><span class="line">       <span class="keyword">int</span> MaxRowsAtCompileTime = RowsAtCompilTime,</span><br><span class="line">       <span class="keyword">int</span> MaxColsAtCompileTime = ColsAtCompilTime&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>Options</code> ：<code>0</code> 表示按列优先存储；<code>RowMajor</code> 表示按行优先存储。例如，一个3x3行优先矩阵：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Matrix&lt;<span class="keyword">float</span>, <span class="number">3</span>, <span class="number">3</span>, RowMajor&gt; m;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>MaxRowsAtCompileTime</code> <code>MaxColsAtCompileTime</code> ：不知道矩阵具体大小，但知道维度上限的时候很有用，这么做的最大原因是为了避免动态内存分配。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Matrix&lt;<span class="keyword">float</span>, Dynamic, Dynamic, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>&gt; m</span><br></pre></td></tr></table></figure>
<p>这句话定义的矩阵仅仅使用了一个大小为12的float数组。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/Eigen/Eigen%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Eigen/Eigen%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Eigen安装及使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-20 13:04:18" itemprop="dateCreated datePublished" datetime="2021-04-20T13:04:18+08:00">2021-04-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-23 15:42:25" itemprop="dateModified" datetime="2021-04-23T15:42:25+08:00">2021-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Eigen/" itemprop="url" rel="index"><span itemprop="name">Eigen</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libeigen3-dev</span><br></pre></td></tr></table></figure>
<h5 id="版本查看"><a href="#版本查看" class="headerlink" title="版本查看"></a>版本查看</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tac /usr/include/eigen3/Eigen/src/Core/util/Macros.h</span><br></pre></td></tr></table></figure>
<p>tac: 文本从后往前输出 —&gt; 版本为3.3.4</p>
<p><img src="/Eigen/Eigen%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/1618895371768.png" alt="output"></p>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>CMakeLists.txt中添加</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Eigen3 REQUIRED)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;EIGEN3_INCLUDE_DIR&#125;</span>)</span><br></pre></td></tr></table></figure>
<p>头文件中包含</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Eigen&gt;</span> </span></span><br></pre></td></tr></table></figure>
<p>如果出现找不到FineEigen.cmake错误，在系统中找到FindEigen.cmake并复制到项目文件夹下，修改CMakeLists.txt为：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span>(CMAKE_MODULE_PATH $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;)</span><br><span class="line"><span class="built_in">include_directories</span>($&#123;EIGEN3_INCLUDE_DIRS&#125;)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/%E8%AE%BA%E6%96%87%E6%B3%9B%E8%AF%BB/[%E6%B3%9B]Building-Fusion%EF%BC%9A%E8%AF%AD%E4%B9%89%E6%84%9F%E7%9F%A5%E7%BB%93%E6%9E%84%E5%8C%96%E5%BB%BA%E7%AD%91%E8%A7%84%E6%A8%A1%E7%9A%84%E4%B8%89%E7%BB%B4%E9%87%8D%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E8%AE%BA%E6%96%87%E6%B3%9B%E8%AF%BB/%5B%E6%B3%9B%5DBuilding-Fusion%EF%BC%9A%E8%AF%AD%E4%B9%89%E6%84%9F%E7%9F%A5%E7%BB%93%E6%9E%84%E5%8C%96%E5%BB%BA%E7%AD%91%E8%A7%84%E6%A8%A1%E7%9A%84%E4%B8%89%E7%BB%B4%E9%87%8D%E5%BB%BA/" class="post-title-link" itemprop="url">[泛]Building Fusion：语义感知结构化建筑规模的三维重建</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-18 23:43:50" itemprop="dateCreated datePublished" datetime="2021-04-18T23:43:50+08:00">2021-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-19 01:15:27" itemprop="dateModified" datetime="2021-04-19T01:15:27+08:00">2021-04-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%BA%E6%96%87%E6%B3%9B%E8%AF%BB/" itemprop="url" rel="index"><span itemprop="name">论文泛读</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Zheng T, Zhang G, Han L, et al. <a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/abstract/document/9286413/"><strong>Building Fusion: Semantic-aware Structural Building-scale 3D Reconstruction</strong></a> [J]. IEEE Transactions on Pattern Analysis and Machine Intelligence, 2020</p>
<p>清华-伯克利深圳学院，清华大学</p>
</blockquote>
<h5 id="针对什么问题"><a href="#针对什么问题" class="headerlink" title="针对什么问题"></a>针对什么问题</h5><ol>
<li><p>如何实现<strong>在线</strong>的<strong>建筑规模</strong>的<strong>协同</strong>三维重建，为室内场景提供详细的几何、语义和结构化信息</p>
</li>
<li><p>如何解决场景中相似房间导致的回环检测出错</p>
</li>
</ol>
<h5 id="采用什么方法"><a href="#采用什么方法" class="headerlink" title="采用什么方法"></a>采用什么方法</h5><p>提出了一个中心化架构的语义感知结构化建筑规模的三维重建系统Building Fusion：</p>
<ol>
<li><p>采用分层场景结构实现全局连续的在线重建</p>
<ul>
<li><p>协同进行密集重建，每个agent的重建都采用基于<strong>关键帧</strong>的重建方法(组合时间连续帧)</p>
</li>
<li><p>采用<strong>子图策略</strong>组合空间连续帧，该方法提高了位姿图优化和深度融合的效率</p>
</li>
</ul>
</li>
<li><p>采用[8]提出的<strong>三维语义-实例分割网络</strong>实现在线语义和实例预测，用来检测房间</p>
</li>
<li><p>提出的房间规模的语义感知结构化回环检测方法 (LCD) 实现了对不同agent间匹配关系的寻找，从而形成全局连续的地图</p>
<ul>
<li><p>输入实例分割标签，预测实例级embedding，该网络对物体形状信息进行编码</p>
</li>
<li><p>基于第一步求出的实例形状embedding计算当前房间和数据库中所有房间的相似度</p>
</li>
<li><p>采用图匹配方法和ICP进行几何验证，检查这些房间是否能很好地对齐，并剔除误判。该方法受[45]所提出的基于物体的图匹配方法的启发，并将其扩展到大规模场景</p>
</li>
</ul>
</li>
</ol>
<h5 id="达到什么效果"><a href="#达到什么效果" class="headerlink" title="达到什么效果"></a>达到什么效果</h5><ol>
<li><p>和基于实例分割的其他方法比Recall@N（语义标签直方图和PointNet[23]）</p>
<p><img src="/%E8%AE%BA%E6%96%87%E6%B3%9B%E8%AF%BB/[%E6%B3%9B]Building-Fusion%EF%BC%9A%E8%AF%AD%E4%B9%89%E6%84%9F%E7%9F%A5%E7%BB%93%E6%9E%84%E5%8C%96%E5%BB%BA%E7%AD%91%E8%A7%84%E6%A8%A1%E7%9A%84%E4%B8%89%E7%BB%B4%E9%87%8D%E5%BB%BA/1618760751878.png" alt="Recall@N comparisons"></p>
<ul>
<li>PointNet泛化能力差，无法生成好的形状embedding</li>
<li>Semantic Label Histogram在Recall@N上表现较好，但不能区分来自相同种类的不同物体</li>
<li>本文提出的方法成功将相似几何外形的物体进行分类</li>
</ul>
</li>
<li><p>和不用实例分割的方法相比（PointNetVLAD和FPFH）</p>
</li>
<li><p>和二维回环检测相比（BoBW）</p>
<p><img src="/%E8%AE%BA%E6%96%87%E6%B3%9B%E8%AF%BB/[%E6%B3%9B]Building-Fusion%EF%BC%9A%E8%AF%AD%E4%B9%89%E6%84%9F%E7%9F%A5%E7%BB%93%E6%9E%84%E5%8C%96%E5%BB%BA%E7%AD%91%E8%A7%84%E6%A8%A1%E7%9A%84%E4%B8%89%E7%BB%B4%E9%87%8D%E5%BB%BA/1618761353123.png" alt="Table1"></p>
<ul>
<li>BoBW表现不好的可能原因：1)BoBW所用数据集太大了，从而降低了命中率  2) BoBW不擅长从新的位姿进行定位（not good at relocalizing from novel poses）</li>
</ul>
</li>
<li><p>建筑规模重建（和Golodetz[4]相比，后者不能得到理想的结果）</p>
</li>
<li><p>消融实验表明：</p>
<ul>
<li>Room-level LCD：通过房间级的几何与语义信息进行对齐，不再受二维相似图像影响</li>
<li>Submap-based reconstruction：大大降低了系统处理所需的时间和内存</li>
<li>Submap reintegration：实现无缝重建，重建结果更加平滑</li>
</ul>
</li>
</ol>
<h5 id="存在什么不足"><a href="#存在什么不足" class="headerlink" title="存在什么不足"></a>存在什么不足</h5><ol>
<li>几何重建方面<ul>
<li>视觉跟踪器(visual tracker)导致的漂移误差(drift error)，缺乏足够视觉特征时会跟丢(tracking loss)   &lt;=  增加惯性传感器提高跟踪准确率和鲁棒性</li>
<li>对齐房间的时候ICP无法稳定生成最佳结果  &lt;=  用学习的三维特征代替[60]</li>
<li>重建结果可能会因为扫描密度不够而不完整  &lt;=  使用数据驱动的方法[61], [62]</li>
</ul>
</li>
<li>对场景的语义和结构化理解方面<ul>
<li>在训练集中未出现的物体/不完整重建的物体，分割结果较差  &lt;=  根据场景微调模型或采用更好的数据增强方法或采用当前更好的实例/语义分割方法</li>
<li>当前只建模了房间，未来可以增加其他结构类型</li>
<li>当前只考虑了静态场景，还没有考虑动态场景</li>
</ul>
</li>
</ol>
<p>[4] S. Golodetz, T. Cavallari, N. A. Lord, V. A. Prisacariu, D. W. Murray, and P. H. Torr, “Collaborative large-scale dense 3d reconstruction with online inter-agent pose optimisation,” IEEE transactions on visualization and computer graphics, vol. 24, no. 11, pp. 2895–2905, 2018.</p>
<ul>
<li>对比文献，建筑规模重建</li>
</ul>
<p>[8] L. Han, T. Zheng, L. Xu, and L. Fang, “Occuseg: Occupancy-aware 3d instance segmentation,” arXiv preprint arXiv:2003.06537, 2020.</p>
<ul>
<li>参考工作，实现房间检测的三维语义-实例分割网络</li>
</ul>
<p>[23] C. R. Qi, H. Su, K. Mo, and L. J. Guibas, “Pointnet: Deep learning on point sets for 3d classification and segmentation,” in Proceedings of the IEEE conference on computer vision and pattern recognition, 2017, pp. 652–660.</p>
<ul>
<li>对比文献，PointNet，基于实例分割，泛化能力差</li>
</ul>
<p>[45] R. Finman, L. Paull, and J. J. Leonard, “Toward object-based place recognition in dense rgb-d maps,” in ICRA Workshop Visual</p>
<ul>
<li>参考工作，基于物体的图匹配方法，本文将其拓展到大规模场景</li>
</ul>
<p>[53] A. Dai, A. X. Chang, M. Savva, M. Halber, T. Funkhouser, and M. Nießner, “Scannet: Richly-annotated 3d reconstructions of indoor scenes,” in Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition, 2017, pp. 5828–5839.</p>
<ul>
<li>RGBD视频数据集，包括了在707个不同地点的1513段扫描、重建的三维模型和三维语义/实例分割GT标签，广泛应用于三维语义和实例分割</li>
</ul>
<p>[60] C. Choy, J. Park, and V. Koltun, “Fully convolutional geometric features,” in ICCV, 2019.</p>
<ul>
<li>未来工作参考，基于学习的三维特征</li>
</ul>
<p>[61] A. Dai, D. Ritchie, M. Bokeloh, S. Reed, J. Sturm, and M. Nießner, “Scancomplete: Large-scale scene completion and semantic segmentation for 3d scans,” in Proc. Computer Vision and Pattern Recognition (CVPR), IEEE, 2018.</p>
<ul>
<li>未来工作参考，数据驱动</li>
</ul>
<p>[62] A. Dai, C. Diller, and M. Nießner, “Sg-nn: Sparse generative neural networks for self-supervised scene completion of rgb-d scans,” in Proc. Computer Vision and Pattern Recognition (CVPR), IEEE, 2020.</p>
<ul>
<li>未来工作参考，数据驱动</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://weihongpan.github.io/uncategorized/Reinforcement-Learning-Including-Q-learning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="潘薇鸿">
      <meta itemprop="description" content="跬步千里">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="潘薇鸿">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/uncategorized/Reinforcement-Learning-Including-Q-learning/" class="post-title-link" itemprop="url">Reinforcement Learning (Including Q-learning)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-01 02:24:04" itemprop="dateCreated datePublished" datetime="2021-04-01T02:24:04+08:00">2021-04-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="潘薇鸿"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">潘薇鸿</p>
  <div class="site-description" itemprop="description">跬步千里</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/WeihongPan" title="GitHub → https://github.com/WeihongPan" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">潘薇鸿</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
